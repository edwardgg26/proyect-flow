!function(){!async function(){try{const t="/api/tareas?id="+h(),n=await fetch(t),o=await n.json();e=o.tareas,a=o.usuarioPermitido,u()}catch(e){p(e.message,!1,"danger",document.querySelector("#contenedorAlertasVentana"))}}();let e=[],t=[],a=!1;const n=document.querySelector(".btnFormulario");n.addEventListener("click",(function(){!function(t){let a=!1;if(!c.value.trim()){a=!0;p("Debe ingresar el nombre de la tarea",!0,"danger",document.querySelector("#campoTarea"),c)}if(!d.value){a=!0;p("Debe ingresar una fecha de inicio",!0,"danger",document.querySelector("#campoFechaIni"),d)}if(Date.parse(r.value)<Date.parse(d.value)){a=!0;p("La fecha de finalizacion debe ser mayor o igual a la fecha de inicio.",!0,"danger",document.querySelector("#campoFechaFin"),r)}if(!1===a)if("agregartarea"==t)!async function(){const t=new FormData;t.append("tarea",c.value.trim()),t.append("fechaInicio",d.value.trim()),t.append("fechaFin",r.value.trim()),t.append("id_proyecto",h());try{const a="http://localhost:3000/api/tarea",n=await fetch(a,{method:"POST",body:t}),o=await n.json();if(p(o.mensaje,!1,o.tipo,document.querySelector("#contenedorAlertas")),"success"==o.tipo){const t={id:String(o.id),tarea:c.value,estado:"0",fechaInicio:d.value,fechaFin:r.value,id_proyecto:o.id_proyecto};e=[...e,t],c.value="",d.value="",r.value="",u()}}catch(e){p(e.message,!1,"danger",document.querySelector("#contenedorAlertas"))}}();else{m({id:o,tarea:c.value,estado:i,fechaInicio:d.value,fechaFin:r.value})}}(n.id)}));document.querySelectorAll("#filtros input").forEach(e=>{e.addEventListener("input",l)});let o=null,i="";const c=document.querySelector("#tarea");c.addEventListener("input",e=>{f(c)});const d=document.querySelector("#fechaInicio");d.addEventListener("input",e=>{f(d)});const r=document.querySelector("#fechaFin");r.addEventListener("input",e=>{f(r)});const s=document.getElementById("modalTarea");function l(a){const n=a.target.value;t=""!=n?e.filter(e=>e.estado===n):[],u()}function u(){!function(){const e=document.querySelector("#listado-tareas");for(;e.firstChild;)e.removeChild(e.firstChild)}(),function(){const t=e.filter(e=>"0"===e.estado),a=document.querySelector("#pendientes");0==t.length?a.disabled=!0:a.disabled=!1}(),function(){const t=e.filter(e=>"1"===e.estado),a=document.querySelector("#completas");0==t.length?a.disabled=!0:a.disabled=!1}();const n=t.length?t:e;if(0!==n.length){const t=document.querySelector("#listado-tareas"),o={0:{estilo:"warning",texto:"Pendiente"},1:{estilo:"success",texto:"Completada"}};n.forEach(n=>{const i=document.createElement("LI");i.classList.add("list-group-item","d-flex"),i.dataset.tareaId=n.id;const c=document.createElement("DIV");c.classList.add("d-flex","w-100","justify-content-between","align-items-center");const d=document.createElement("DIV");d.innerHTML=`<p class="h5">${n.tarea}</p>\n                                                <p class="m-0">Fecha de Inicio: ${n.fechaInicio}</p>`,"0000-00-00"!=n.fechaFin&&""!=n.fechaFin&&(d.innerHTML+=`<p class="m-0">Fecha de Fin: ${n.fechaFin}</p>`);const r=document.createElement("DIV");r.classList.add("d-flex","flex-column","gap-1","d-sm-block");const s=document.createElement("BUTTON");s.classList.add("btn","btn-"+o[n.estado].estilo,"ms-1"),s.textContent=o[n.estado].texto,s.dataset.estadoTarea=n.estado,s.onclick=function(){!function(e){const t="1"===e.estado?"0":"1";e.estado=t,m(e)}({...n})},!1===a&&(s.disabled=!0);const l=document.createElement("BUTTON");l.classList.add("btn","btn-danger","ms-1"),l.textContent="Eliminar",l.onclick=function(){!async function(t){if(confirm("Â¿Estas seguro/a de eliminar esta tarea?")){const{estado:a,id:n,tarea:o,fechaInicio:i,fechaFin:c}=t,d=new FormData;d.append("id",n),d.append("tarea",o),d.append("estado",a),d.append("fechaInicio",i),d.append("fechaFin",c),d.append("id_proyecto",h());try{const a="http://localhost:3000/api/tarea/eliminar",n=await fetch(a,{body:d,method:"POST"});"success"==(await n.json()).tipo&&(e=e.filter(e=>e.id!==t.id),u())}catch(e){p(e.message,!1,"danger",document.querySelector("#contenedorAlertas"))}}}({...n})};const f=document.createElement("BUTTON");f.classList.add("btn","btn-primary","ms-1"),f.textContent="Editar",f.dataset.bsToggle="modal",f.dataset.bsTarget="#modalTarea",f.dataset.bsWhatever="Editar Tarea",f.dataset.tareaId=n.id,r.appendChild(s),!0===a&&(r.appendChild(f),r.appendChild(l)),c.appendChild(d),c.appendChild(r),i.appendChild(c),t.appendChild(i)})}}async function m(t){const{estado:a,id:n,tarea:o,fechaInicio:i,fechaFin:c}=t,d=new FormData;d.append("id",n),d.append("tarea",o),d.append("estado",a),d.append("fechaInicio",i),d.append("fechaFin",c),d.append("id_proyecto",h());try{const t="http://localhost:3000/api/tarea/actualizar",r=await fetch(t,{method:"POST",body:d}),s=await r.json();p(s.mensaje,!1,s.tipo,document.querySelector("#contenedorAlertas")),"success"==s.tipo&&(e=e.map(e=>(e.id==n&&(e.estado=a,e.tarea=o,e.fechaInicio=i,e.fechaFin=c),e)),u())}catch(e){p(e.message,!1,"danger",document.querySelector("#contenedorAlertas"))}}function p(e,t,a,n,o=null){if(t){o.classList.contains("is-invalid")||o.classList.add("is-invalid");if(null===document.querySelector("#alerta"+o.getAttribute("id"))){const t=document.createElement("DIV");t.classList.add("invalid-feedback"),t.setAttribute("id","alerta"+o.getAttribute("id")),t.innerHTML=e,n.appendChild(t)}}else{if(!document.querySelector(".alertaSinCampo")){const t=document.createElement("DIV");t.classList.add("alert","alert-"+a,"alert-dismissible","fade","show","alertaSinCampo"),t.setAttribute("role","alert"),t.setAttribute("tabindex","-1"),t.textContent=e;const o=document.createElement("BUTTON");o.setAttribute("type","button"),o.classList.add("btn-close"),o.dataset.bsDismiss="alert",o.ariaLabel="Close",t.appendChild(o),n.appendChild(t)}}}function f(e){e.classList.remove("is-invalid");const t=document.querySelector("#alerta"+e.getAttribute("id"));null!==t&&t.remove()}function h(){return Object.fromEntries(new URLSearchParams(window.location.search)).id}s&&s.addEventListener("show.bs.modal",t=>{document.querySelector("#contenedorAlertas").innerHTML="";const a=t.relatedTarget,n=a.getAttribute("data-bs-whatever");s.querySelector(".modal-title").textContent=n;const l=n.replace(/ /g,"").toLowerCase();if(s.querySelector(".btnFormulario").id=l,"agregartarea"==l)o=null,c.value="",d.value="",r.value="";else{const t=a.getAttribute("data-tarea-id"),n=e.filter(e=>e.id==t)[0];c.value=n.tarea,d.value=n.fechaInicio,r.value=n.fechaFin,o=t,i=n.estado}})}();